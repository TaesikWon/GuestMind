{% extends "base.html" %}

{% block title %}ì±„íŒ… - SoulStay{% endblock %}

{% block content %}
<div class="row justify-content-center">
    <div class="col-md-8">
        <div class="card">
            <div class="card-header bg-brown text-white">
                <h4 class="mb-0">ğŸ’¬ SoulStay ì±—ë´‡</h4>
            </div>
            <div class="card-body">
                <!-- ì±„íŒ… ë©”ì‹œì§€ ì˜ì—­ -->
                <div id="chat-messages" style="height: 400px; overflow-y: auto; border: 1px solid #ddd; border-radius: 8px; padding: 15px; margin-bottom: 20px; background-color: #fdfcfa;">
                    <p class="text-muted">ì•ˆë…•í•˜ì„¸ìš”! ë¬´ì—‡ì„ ë„ì™€ë“œë¦´ê¹Œìš”? ğŸ˜Š</p>
                </div>

                <!-- ì…ë ¥ í¼ -->
                <form id="chat-form">
                    <div class="input-group">
                        <input type="text" id="message-input" class="form-control" placeholder="ë©”ì‹œì§€ë¥¼ ì…ë ¥í•˜ì„¸ìš”..." required>
                        <button type="submit" class="btn btn-primary">ì „ì†¡</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>

<script>
    const chatMessages = document.getElementById('chat-messages');
    const chatForm = document.getElementById('chat-form');
    const messageInput = document.getElementById('message-input');

    chatForm.addEventListener('submit', async (e) => {
        e.preventDefault();
        
        const message = messageInput.value.trim();
        if (!message) return;

        // ì‚¬ìš©ì ë©”ì‹œì§€ í‘œì‹œ
        addMessage('user', message);
        messageInput.value = '';

        try {
            // ì„œë²„ì— ë©”ì‹œì§€ ì „ì†¡
            const response = await fetch('/chat', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({ message: message })
            });

            const data = await response.json();
            
            // ë´‡ ì‘ë‹µ í‘œì‹œ
            addMessage('bot', data.response || 'ì‘ë‹µì„ ë°›ì§€ ëª»í–ˆìŠµë‹ˆë‹¤.');
            
        } catch (error) {
            addMessage('bot', 'âš ï¸ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.');
            console.error('Error:', error);
        }
    });

    function addMessage(sender, text) {
        const messageDiv = document.createElement('div');
        messageDiv.className = `mb-3 ${sender === 'user' ? 'text-end' : 'text-start'}`;
        
        const bubble = document.createElement('div');
        bubble.className = `d-inline-block p-3 rounded ${sender === 'user' ? 'bg-brown text-white' : 'bg-light'}`;
        bubble.style.maxWidth = '70%';
        bubble.textContent = text;
        
        messageDiv.appendChild(bubble);
        chatMessages.appendChild(messageDiv);
        
        // ìŠ¤í¬ë¡¤ì„ ë§¨ ì•„ë˜ë¡œ
        chatMessages.scrollTop = chatMessages.scrollHeight;
    }
</script>
{% endblock %}